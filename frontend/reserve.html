<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ | Tasty Bar</title>
  <link rel="icon" type="image/png" href="/img/logo.png">
  <link rel="stylesheet" href="/css/reserve.css">
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <img src="/img/logo.png" alt="logo" class="logo">
    <ul>
      <li><a href="/login.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></li>
      <li><a href="/main.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
      <li><a href="/notifications.html">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</a></li>
      <li><a href="/contact.html">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a></li>
    </ul>
  </div>

  <!-- Content -->
  <div class="background">
    <div class="colum">
      <div class="img">
        <img src="/img/table.png" alt="‡∏ú‡∏±‡∏á‡πÇ‡∏ï‡πä‡∏∞">
      </div>

      <div class="reserve-box">
        <div class="reserve-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞</div>

        <select id="tableSelect">
          <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞ --</option>
          <option value="1">‡πÇ‡∏ï‡πä‡∏∞ 1</option>
          <option value="2">‡πÇ‡∏ï‡πä‡∏∞ 2</option>
          <option value="3">‡πÇ‡∏ï‡πä‡∏∞ 3</option>
          <option value="4">‡πÇ‡∏ï‡πä‡∏∞ 4</option>
          <option value="3">‡πÇ‡∏ï‡πä‡∏∞ 5</option>
          <option value="4">‡πÇ‡∏ï‡πä‡∏∞ 6</option>
          <option value="3">‡πÇ‡∏ï‡πä‡∏∞ 7</option>
          <option value="4">‡πÇ‡∏ï‡πä‡∏∞ 8</option>

        </select>

        <button id="confirmBtn">‡∏ï‡∏Å‡∏•‡∏á</button>
      </div>
    </div>
  </div>

  <script>
    // üìç ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL ‡πÄ‡∏ä‡πà‡∏ô ?table=1&status=busy
    function getQueryParams() {
      const p = new URLSearchParams(location.search);
      return {
        table: p.get('table') || '',
        status: p.get('status') || ''
      };
    }

    // üìç ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å localStorage
    function loadReservedTables() {
      try {
        return JSON.parse(localStorage.getItem('reservedTables')) || [];
      } catch {
        return [];
      }
    }

    // üìç ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
    function saveReservedTable(tableId) {
      const reserved = loadReservedTables();
      if (!reserved.includes(tableId)) {
        reserved.push(tableId);
        localStorage.setItem('reservedTables', JSON.stringify(reserved));
      }
    }

    // üìç ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ï‡πä‡∏∞‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    function updateTableStatus() {
      const { table, status } = getQueryParams();
      const select = document.getElementById('tableSelect');
      const reserved = loadReservedTables();

      // ‡∏õ‡∏¥‡∏î‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      reserved.forEach(tid => {
        const opt = select.querySelector(`option[value="${tid}"]`);
        if (opt) {
          opt.disabled = true;
          opt.textContent = `‡πÇ‡∏ï‡πä‡∏∞ ${tid} (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á)`;
        }
      });

      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ status-update
      if (table) {
        const opt = select.querySelector(`option[value="${table}"]`);
        if (opt) {
          if (status === 'busy') {
            opt.disabled = true;
            opt.textContent = `‡πÇ‡∏ï‡πä‡∏∞ ${table} (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á)`;
            alert(`‡πÇ‡∏ï‡πä‡∏∞ ${table} ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏∑‡πà‡∏ô`);
          } else {
            select.value = table;
          }
        }
      }
    }

    // üìç ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏Å‡∏•‡∏á"
    function setupConfirmButton() {
      const select = document.getElementById('tableSelect');
      document.getElementById('confirmBtn').addEventListener('click', () => {
        const table = select.value;
        if (!table) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡πà‡∏≠‡∏ô');
          return;
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‚Äù
        saveReservedTable(table);

        // ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠
        localStorage.setItem('reservationTable', table);

        // ‚úÖ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ data.html
        window.location.href = '/data.html';
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateTableStatus();
      setupConfirmButton();
    });
  </script>
</body>
</html>
